<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-Commerce Platform</title>
<style>
  :root {
    --primary: #2563eb;
    --primary-hover: #1d4ed8;
    --success: #16a34a;
    --danger: #dc2626;
    --warning: #d97706;
    --bg: #f8fafc;
    --surface: #ffffff;
    --border: #e2e8f0;
    --text: #1e293b;
    --text-muted: #64748b;
    --radius: 8px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.5;
  }

  /* Header */
  header {
    background: var(--text);
    color: white;
    padding: 0 24px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  header h1 { font-size: 18px; font-weight: 600; }
  header h1 span { color: var(--primary); }

  nav { display: flex; gap: 4px; }

  nav button {
    background: transparent;
    color: #94a3b8;
    border: none;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    border-radius: var(--radius);
    transition: all 0.15s;
  }

  nav button:hover { color: white; background: rgba(255,255,255,0.1); }
  nav button.active { color: white; background: var(--primary); }

  .cart-btn {
    background: var(--primary) !important;
    color: white !important;
    font-weight: 500;
    position: relative;
  }

  .cart-btn .badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--danger);
    color: white;
    font-size: 11px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
  }

  /* Main layout */
  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 24px;
  }

  .page { display: none; }
  .page.active { display: block; }

  /* Product grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .product-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.15s;
  }

  .product-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

  .product-category {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 8px;
  }

  .product-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
  .product-desc { font-size: 13px; color: var(--text-muted); margin-bottom: 12px; flex: 1; }
  .product-sku { font-size: 11px; color: var(--text-muted); margin-bottom: 12px; }

  .product-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }

  .product-price { font-size: 20px; font-weight: 700; color: var(--text); }

  .qty-control {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .qty-control button {
    width: 28px;
    height: 28px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .qty-control span { font-size: 14px; font-weight: 500; min-width: 20px; text-align: center; }

  .add-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: background 0.15s;
  }

  .add-btn:hover { background: var(--primary-hover); }
  .add-btn:disabled { background: #94a3b8; cursor: not-allowed; }

  /* Cart page */
  .cart-empty {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
  }

  .cart-empty svg { width: 64px; height: 64px; margin-bottom: 16px; opacity: 0.3; }

  .cart-items { display: flex; flex-direction: column; gap: 12px; }

  .cart-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .cart-item-info { flex: 1; }
  .cart-item-name { font-weight: 600; font-size: 15px; }
  .cart-item-sku { font-size: 12px; color: var(--text-muted); }
  .cart-item-price { font-weight: 600; font-size: 15px; min-width: 80px; text-align: right; }

  .cart-item .remove-btn {
    background: none;
    border: none;
    color: var(--danger);
    cursor: pointer;
    font-size: 13px;
    padding: 4px 8px;
  }

  .cart-item .remove-btn:hover { text-decoration: underline; }

  .cart-summary {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    margin-top: 20px;
  }

  .cart-total {
    display: flex;
    justify-content: space-between;
    font-size: 18px;
    font-weight: 700;
    padding: 12px 0;
    border-top: 2px solid var(--text);
    margin-top: 8px;
  }

  /* Checkout form */
  .checkout-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-top: 20px;
  }

  .checkout-section h3 { margin-bottom: 16px; font-size: 16px; }

  .form-group { margin-bottom: 16px; }
  .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 4px; color: var(--text-muted); }
  .form-group input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    outline: none;
    transition: border-color 0.15s;
  }
  .form-group input:focus { border-color: var(--primary); }

  .checkout-btn {
    background: var(--success);
    color: white;
    border: none;
    padding: 12px 32px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    width: 100%;
    transition: background 0.15s;
  }
  .checkout-btn:hover { background: #15803d; }
  .checkout-btn:disabled { background: #94a3b8; cursor: not-allowed; }

  /* Orders page */
  .orders-list { display: flex; flex-direction: column; gap: 12px; }

  .order-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
  }

  .order-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .order-number { font-weight: 700; font-size: 15px; }

  .status-badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-Pending { background: #fef3c7; color: #92400e; }
  .status-PaymentValidated { background: #dbeafe; color: #1e40af; }
  .status-Processing { background: #e0e7ff; color: #3730a3; }
  .status-InventoryReserved { background: #d1fae5; color: #065f46; }
  .status-Fulfilled { background: #bbf7d0; color: #166534; }
  .status-Shipped { background: #a7f3d0; color: #14532d; }
  .status-Failed { background: #fecaca; color: #991b1b; }
  .status-Cancelled { background: #e5e7eb; color: #374151; }

  .order-detail { font-size: 13px; color: var(--text-muted); margin-bottom: 4px; }
  .order-items { margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); }
  .order-items li { font-size: 13px; margin-left: 16px; color: var(--text-muted); }
  .order-total { font-weight: 700; margin-top: 8px; text-align: right; }

  /* Inventory page */
  .inventory-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .inventory-table th {
    background: #f1f5f9;
    text-align: left;
    padding: 12px 16px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    font-weight: 600;
  }

  .inventory-table td { padding: 12px 16px; font-size: 14px; border-top: 1px solid var(--border); }
  .inventory-table tr:hover td { background: #f8fafc; }

  .stock-ok { color: var(--success); font-weight: 600; }
  .stock-low { color: var(--warning); font-weight: 600; }
  .stock-out { color: var(--danger); font-weight: 600; }

  /* Pipeline page */
  .pipeline-container {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
  }

  .queue-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }

  .queue-stat {
    background: #f8fafc;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    text-align: center;
  }

  .queue-stat .count { font-size: 28px; font-weight: 700; }
  .queue-stat .label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; }

  /* Alerts */
  .alert {
    padding: 12px 16px;
    border-radius: var(--radius);
    margin-bottom: 16px;
    font-size: 14px;
  }

  .alert-success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
  .alert-error { background: #fecaca; color: #991b1b; border: 1px solid #fca5a5; }
  .alert-info { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }

  /* Section headers */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .section-header h2 { font-size: 22px; }

  .refresh-btn {
    background: none;
    border: 1px solid var(--border);
    padding: 8px 16px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 13px;
    color: var(--text-muted);
  }

  .refresh-btn:hover { background: #f1f5f9; }

  /* Toast */
  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toast {
    background: var(--text);
    color: white;
    padding: 12px 20px;
    border-radius: var(--radius);
    font-size: 14px;
    animation: slideIn 0.2s ease, fadeOut 0.3s ease 2.7s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .toast-success { background: var(--success); }
  .toast-error { background: var(--danger); }

  @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  @keyframes fadeOut { to { opacity: 0; } }

  /* Loading spinner */
  .loading {
    display: flex;
    justify-content: center;
    padding: 40px;
    color: var(--text-muted);
  }

  .spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--border);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Search */
  .search-bar {
    margin-bottom: 20px;
  }

  .search-bar input {
    width: 100%;
    max-width: 400px;
    padding: 10px 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    outline: none;
  }

  .search-bar input:focus { border-color: var(--primary); }
</style>
</head>
<body>

<header>
  <h1><span>&#9679;</span> E-Commerce Platform</h1>
  <nav>
    <button class="active" onclick="showPage('shop')">Shop</button>
    <button onclick="showPage('cart-page')">Cart</button>
    <button onclick="showPage('orders')">Orders</button>
    <button onclick="showPage('inventory')">Inventory</button>
    <button class="cart-btn" onclick="showPage('cart-page')">
      Cart <span class="badge" id="cart-badge">0</span>
    </button>
  </nav>
</header>

<main>
  <!-- SHOP PAGE -->
  <div id="shop" class="page active">
    <div class="section-header">
      <h2>Products</h2>
    </div>
    <div class="search-bar">
      <input type="text" id="product-search" placeholder="Search products..." oninput="filterProducts()">
    </div>
    <div class="products-grid" id="products-grid">
      <div class="loading"><div class="spinner"></div></div>
    </div>
  </div>

  <!-- CART PAGE -->
  <div id="cart-page" class="page">
    <div class="section-header">
      <h2>Shopping Cart</h2>
    </div>
    <div id="cart-alerts"></div>
    <div id="cart-content"></div>
  </div>

  <!-- ORDERS PAGE -->
  <div id="orders" class="page">
    <div class="section-header">
      <h2>Orders</h2>
      <button class="refresh-btn" onclick="loadOrders()">Refresh</button>
    </div>
    <div id="orders-content">
      <div class="loading"><div class="spinner"></div></div>
    </div>
  </div>

  <!-- INVENTORY PAGE -->
  <div id="inventory" class="page">
    <div class="section-header">
      <h2>Inventory</h2>
      <button class="refresh-btn" onclick="loadInventory()">Refresh</button>
    </div>
    <div id="inventory-content">
      <div class="loading"><div class="spinner"></div></div>
    </div>
  </div>
</main>

<div class="toast-container" id="toast-container"></div>

<script>
const SESSION_ID = 'session-' + Math.random().toString(36).substring(2, 10);
const API = '';
const ORDER_API = window.location.protocol + '//' + window.location.hostname + ':5101';
const INVENTORY_API = window.location.protocol + '//' + window.location.hostname + ':5102';

let products = [];
let cart = { items: [], total: 0 };
let quantities = {};

// --- Navigation ---
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  document.querySelectorAll('nav button:not(.cart-btn)').forEach(b => b.classList.remove('active'));
  const navBtns = document.querySelectorAll('nav button:not(.cart-btn)');
  const map = { 'shop': 0, 'cart-page': 1, 'orders': 2, 'inventory': 3 };
  if (map[pageId] !== undefined) navBtns[map[pageId]].classList.add('active');

  if (pageId === 'orders') loadOrders();
  if (pageId === 'inventory') loadInventory();
  if (pageId === 'cart-page') renderCart();
}

// --- Toast notifications ---
function toast(message, type = '') {
  const container = document.getElementById('toast-container');
  const el = document.createElement('div');
  el.className = 'toast' + (type ? ' toast-' + type : '');
  el.textContent = message;
  container.appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// --- Products ---
async function loadProducts() {
  try {
    const res = await fetch(API + '/api/products');
    products = await res.json();
    renderProducts(products);
  } catch (e) {
    document.getElementById('products-grid').innerHTML =
      '<div class="alert alert-error">Failed to load products: ' + e.message + '</div>';
  }
}

function renderProducts(list) {
  const grid = document.getElementById('products-grid');
  if (list.length === 0) {
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text-muted);padding:40px">No products found</div>';
    return;
  }
  grid.innerHTML = list.map(p => {
    const qty = quantities[p.id] || 1;
    return `
      <div class="product-card">
        <div class="product-category">${esc(p.category)}</div>
        <div class="product-name">${esc(p.name)}</div>
        <div class="product-desc">${esc(p.description)}</div>
        <div class="product-sku">SKU: ${esc(p.sku)}</div>
        <div class="product-footer">
          <div class="product-price">$${p.price.toFixed(2)}</div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="qty-control">
              <button onclick="changeQty(${p.id}, -1)">-</button>
              <span id="qty-${p.id}">${qty}</span>
              <button onclick="changeQty(${p.id}, 1)">+</button>
            </div>
            <button class="add-btn" id="add-btn-${p.id}" onclick="addToCart(${p.id})">Add</button>
          </div>
        </div>
      </div>`;
  }).join('');
}

function filterProducts() {
  const q = document.getElementById('product-search').value.toLowerCase();
  const filtered = products.filter(p =>
    p.name.toLowerCase().includes(q) ||
    p.description.toLowerCase().includes(q) ||
    p.category.toLowerCase().includes(q)
  );
  renderProducts(filtered);
}

function changeQty(productId, delta) {
  const current = quantities[productId] || 1;
  const next = Math.max(1, Math.min(99, current + delta));
  quantities[productId] = next;
  const el = document.getElementById('qty-' + productId);
  if (el) el.textContent = next;
}

// --- Cart ---
async function addToCart(productId) {
  const btn = document.getElementById('add-btn-' + productId);
  btn.disabled = true;
  btn.textContent = '...';
  try {
    const qty = quantities[productId] || 1;
    const res = await fetch(API + '/api/cart/' + SESSION_ID + '/items', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ productId, quantity: qty })
    });
    if (!res.ok) throw new Error('Failed: ' + res.status);
    cart = await res.json();
    updateCartBadge();
    const product = products.find(p => p.id === productId);
    toast('Added ' + qty + 'x ' + product.name + ' to cart', 'success');
  } catch (e) {
    toast('Failed to add to cart: ' + e.message, 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Add';
  }
}

async function removeFromCart(productId) {
  try {
    const res = await fetch(API + '/api/cart/' + SESSION_ID + '/items/' + productId, { method: 'DELETE' });
    if (!res.ok) throw new Error('Failed: ' + res.status);
    cart = await res.json();
    updateCartBadge();
    renderCart();
    toast('Item removed from cart', 'success');
  } catch (e) {
    toast('Failed to remove item: ' + e.message, 'error');
  }
}

async function loadCart() {
  try {
    const res = await fetch(API + '/api/cart/' + SESSION_ID);
    cart = await res.json();
    updateCartBadge();
  } catch (e) { /* ignore */ }
}

function updateCartBadge() {
  const count = cart.items ? cart.items.reduce((sum, i) => sum + i.quantity, 0) : 0;
  document.getElementById('cart-badge').textContent = count;
}

function renderCart() {
  const container = document.getElementById('cart-content');

  if (!cart.items || cart.items.length === 0) {
    container.innerHTML = `
      <div class="cart-empty">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/>
        </svg>
        <p style="font-size:18px;margin-bottom:8px">Your cart is empty</p>
        <p>Browse products and add items to get started</p>
      </div>`;
    return;
  }

  const items = cart.items.map(i => `
    <div class="cart-item">
      <div class="cart-item-info">
        <div class="cart-item-name">${esc(i.productName)}</div>
        <div class="cart-item-sku">SKU: ${esc(i.sku)} &middot; Qty: ${i.quantity} &middot; $${i.unitPrice.toFixed(2)} each</div>
      </div>
      <div class="cart-item-price">$${(i.quantity * i.unitPrice).toFixed(2)}</div>
      <button class="remove-btn" onclick="removeFromCart(${i.productId})">Remove</button>
    </div>`).join('');

  const total = cart.items.reduce((sum, i) => sum + (i.quantity * i.unitPrice), 0);

  container.innerHTML = `
    <div class="cart-items">${items}</div>
    <div class="cart-summary">
      <div class="cart-total">
        <span>Total</span>
        <span>$${total.toFixed(2)}</span>
      </div>
    </div>
    <div class="checkout-section">
      <h3>Checkout</h3>
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="checkout-name" placeholder="Jane Doe" value="Test User">
      </div>
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="checkout-email" placeholder="jane@example.com" value="test@example.com">
      </div>
      <div class="form-group">
        <label>Payment Token (simulated)</label>
        <input type="text" id="checkout-token" placeholder="tok_test_123" value="tok_test_123">
      </div>
      <button class="checkout-btn" id="checkout-btn" onclick="checkout()">Place Order</button>
    </div>`;
}

async function checkout() {
  const name = document.getElementById('checkout-name').value.trim();
  const email = document.getElementById('checkout-email').value.trim();
  const token = document.getElementById('checkout-token').value.trim();

  if (!name || !email) {
    toast('Please fill in name and email', 'error');
    return;
  }

  const btn = document.getElementById('checkout-btn');
  btn.disabled = true;
  btn.textContent = 'Processing...';

  try {
    const res = await fetch(API + '/api/cart/' + SESSION_ID + '/checkout', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        sessionId: SESSION_ID,
        customerName: name,
        customerEmail: email,
        paymentToken: token
      })
    });

    const data = await res.json();

    if (!res.ok) {
      const msg = data.message || 'Checkout failed';
      document.getElementById('cart-alerts').innerHTML =
        '<div class="alert alert-error">' + esc(msg) + '</div>';
      toast('Checkout failed', 'error');
      return;
    }

    cart = { items: [], total: 0 };
    updateCartBadge();

    const orderNum = data.order?.orderNumber || 'unknown';
    document.getElementById('cart-alerts').innerHTML = '';
    document.getElementById('cart-content').innerHTML = `
      <div style="text-align:center;padding:60px 20px">
        <div style="font-size:48px;margin-bottom:16px">&#10003;</div>
        <h2 style="color:var(--success);margin-bottom:8px">Order Placed!</h2>
        <p style="color:var(--text-muted);margin-bottom:4px">${esc(data.message)}</p>
        <p style="font-size:18px;font-weight:600;margin-bottom:24px">Order: ${esc(orderNum)}</p>
        <p style="color:var(--text-muted);font-size:13px;margin-bottom:24px">
          The order is now being processed through the async pipeline.<br>
          Check the Orders tab in ~15 seconds to see it reach Fulfilled status.
        </p>
        <button class="add-btn" onclick="showPage('orders')" style="padding:12px 24px;font-size:15px">View Orders</button>
        <button class="refresh-btn" onclick="showPage('shop')" style="margin-left:8px;padding:12px 24px;font-size:15px">Continue Shopping</button>
      </div>`;
  } catch (e) {
    toast('Checkout error: ' + e.message, 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Place Order';
  }
}

// --- Orders ---
async function loadOrders() {
  const container = document.getElementById('orders-content');
  container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

  try {
    const res = await fetch(ORDER_API + '/api/orders');
    const orders = await res.json();

    if (orders.length === 0) {
      container.innerHTML = '<div class="cart-empty"><p style="font-size:18px">No orders yet</p><p style="color:var(--text-muted)">Place an order from the Shop tab</p></div>';
      return;
    }

    container.innerHTML = '<div class="orders-list">' + orders.map(o => {
      const itemsList = (o.items || []).map(i =>
        `<li>${esc(i.productName)} x${i.quantity} @ $${i.unitPrice.toFixed(2)}</li>`
      ).join('');

      return `
        <div class="order-card">
          <div class="order-header">
            <span class="order-number">${esc(o.orderNumber)}</span>
            <span class="status-badge status-${o.status}">${o.status}</span>
          </div>
          <div class="order-detail">Customer: ${esc(o.customerName)} (${esc(o.customerEmail)})</div>
          <div class="order-detail">Created: ${new Date(o.createdAt).toLocaleString()}</div>
          ${o.items && o.items.length ? '<ul class="order-items">' + itemsList + '</ul>' : ''}
          <div class="order-total">Total: $${o.totalAmount.toFixed(2)}</div>
        </div>`;
    }).join('') + '</div>';
  } catch (e) {
    container.innerHTML = '<div class="alert alert-error">Failed to load orders: ' + e.message +
      '<br><small>Make sure OrderApi is accessible on port 5101</small></div>';
  }
}

// --- Inventory ---
async function loadInventory() {
  const container = document.getElementById('inventory-content');
  container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

  try {
    const res = await fetch(INVENTORY_API + '/api/inventory');
    const items = await res.json();

    const productMap = {};
    products.forEach(p => productMap[p.id] = p.name);

    container.innerHTML = `
      <table class="inventory-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>SKU</th>
            <th>On Hand</th>
            <th>Reserved</th>
            <th>Available</th>
            <th>Warehouse</th>
          </tr>
        </thead>
        <tbody>
          ${items.map(i => {
            const avail = i.quantityOnHand - i.quantityReserved;
            const cls = avail > 20 ? 'stock-ok' : avail > 0 ? 'stock-low' : 'stock-out';
            return `<tr>
              <td><strong>${esc(productMap[i.productId] || 'Product ' + i.productId)}</strong></td>
              <td>${esc(i.sku)}</td>
              <td>${i.quantityOnHand}</td>
              <td>${i.quantityReserved}</td>
              <td class="${cls}">${avail}</td>
              <td>${esc(i.warehouseLocation)}</td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>`;
  } catch (e) {
    container.innerHTML = '<div class="alert alert-error">Failed to load inventory: ' + e.message +
      '<br><small>Make sure InventoryApi is accessible on port 5102</small></div>';
  }
}

// --- Utility ---
function esc(str) {
  if (!str) return '';
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// --- Init ---
loadProducts();
loadCart();
</script>
</body>
</html>
